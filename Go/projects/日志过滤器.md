# 日志过滤器

项目目标是创建一个简单的日志处理工具，能读取日志文件，按行读取日志内容并过滤指定关键字，将过滤后的结果写入另一个文件。

## 项目结构

```bash
log_filter/
├── main.go            # 主程序文件
├── log_reader.go      # 处理日志读取与过滤的函数
└── log_writer.go      # 处理日志写入的函数
```

### 功能描述

1. **读取日志文件**：从指定的日志文件中逐行读取内容。
2. **过滤日志**：根据用户提供的关键字过滤掉无关的日志行。
3. **保存结果**：将过滤后的日志写入到另一个文件。

我们将使用 `bufio.Scanner` 来逐行读取日志，利用 `io.Writer` 写入结果文件，并运用 `bufio.Writer` 来缓冲写入。

## 项目代码

main.go：

```go
package main

import (
	"fmt"
	"log"
	"os"
)

func main() {
	// 获取输入文件路径、输出文件路径以及过滤关键字
	if len(os.Args) < 4 {
		log.Fatalf("Usage: %s <input_file> <output_file> <keyword>", os.Args[0])
	}

	inputFile := os.Args[1]
	outputFile := os.Args[2]
	keyword := os.Args[3]

	// 读取并过滤日志
	filteredLogs, err := ReadAndFilterLogs(inputFile, keyword)
	if err != nil {
		log.Fatalf("Error readfile logs: %v", err)
	}

	// 写入过滤后的日志
	err = WriteFilteredLogs(outputFile, filteredLogs)
	if err != nil {
		log.Fatalf("Error writing filtered logs: %v", err)
	}

	fmt.Printf("Logs containing '%s' have been written to %s\n", keyword, outputFile)
}
```

log_reader.go：

```go
package main

import (
    "bufio"
    "os"
    "strings"
)

// ReadAndFilterLogs 逐行读取日志文件并根据关键字过滤
func ReadAndFilterLogs(filepath string, keyword string) ([]string, error) {
    file, err := os.Open(filepath)
    if err != nil {
       return nil, err
    }
    defer file.Close()

    var filteredLines []string
    scanner := bufio.NewScanner(file)

    for scanner.Scan() {
       line := scanner.Text()
       if strings.Contains(line, keyword) {
          filteredLines = append(filteredLines, line)
       }
    }

    if err := scanner.Err(); err != nil {
       return nil, err
    }

    return filteredLines, nil
}
```

log_writer.go：

```go
package main

import (
    "bufio"
    "os"
)

// WriteFilteredLogs 将过滤后的日志写入目标文件
func WriteFilteredLogs(filepath string, lines []string) error {
    file, err := os.Create(filepath)
    if err != nil {
       return err
    }
    defer file.Close()

    writer := bufio.NewWriter(file)

    for _, line := range lines {
       _, err := writer.WriteString(line + "\n")
       if err != nil {
          return err
       }
    }

    // 确保所有缓冲区中的数据都写入文件
    writer.Flush()

    return nil
}
```

sample.log：

```yaml
INFO: Server started
ERROR: Connection failed
INFO: User logged in
DEBUG: Cache initialized
ERROR: File not found
```

## 项目启动

先生成 `go.mod` 文件。进入到项目的根目录（也就是 LogFilter 目录下），之后运行下面的命令来初始化 Go 模块：

```bash
go mod init LogFilter
```

之后就会自动生成 go.mod 文件。

于是，项目目录结构：

```bash
/LogFilter
├── go.mod            # 由 go mod init 命令生成
├── main.go           # 项目主程序
├── log_reader.go     # 读取日志的功能
├── log_writer.go     # 写入日志的功能
├── sample.log        # 示例日志文件（非必需）
```

编译：

```bash
go build -o main .
```

运行：

```bash
./main sample.log filtered.log ERROR
```

运行结果：

```bash
[root@toby LogFilter]# ./main sample.log filtered.log ERROR
Logs containing 'ERROR' have been written to filtered.log
[root@toby LogFilter]# cat filtered.log
ERROR: Connection failed
ERROR: File not found
```



















