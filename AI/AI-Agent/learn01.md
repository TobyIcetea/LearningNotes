# AI Agent

## Python è°ƒ DeepSeek API

è¿›å…¥ DeepSeek çš„ API çš„å®˜ç½‘ï¼š[api-keys](https://platform.deepseek.com/api_keys)ã€‚

å‰æå½“æ—¶æ˜¯è¦å…ˆå……å¥½é’±ï¼Œæ¯”å¦‚æˆ‘è¿™æ¬¡å……äº†åå—é’±ï¼Œä¹‹åå¯ä»¥åœ¨ API Keys ä¸­åˆ›å»ºä¸€ä¸ª APIã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒAPI åˆ›å»ºä¹‹åéœ€è¦é©¬ä¸Šä¿å­˜å¥½ï¼Œä¹‹åå°±ä¸èƒ½æŸ¥çœ‹è¿™ä¸ª API æ˜¯å•¥äº†ã€‚

å†ç„¶åï¼Œå°±å¯ä»¥ä½¿ç”¨ Python ä»£ç æ¥è°ƒç”¨ DeepSeek çš„ APIï¼š

```python
from openai import OpenAI

client = OpenAI(api_key="å¯†é’¥å¯†é’¥å¯†é’¥", base_url="https://api.deepseek.com")

response = client.chat.completions.create(
    model = "deepseek-chat",
    messages= [
        {"role": "system", "content": "You are a helpful assistant"},
        {"role": "user", "content": "Hello"},
    ],
    stream = False
)

print(response.choices[0].message.content)
```

è¿è¡Œä»£ç ä¼šè¾“å‡ºï¼š

> Hello! How can I assist you today? ğŸ˜Š

å®˜ç½‘è¿˜æä¾›äº†å…¶ä»–çš„ API è°ƒç”¨æ–¹å¼ï¼Œä¸€å…±æœ‰ä¸‰ç§ï¼Œåˆ†åˆ«æ˜¯ curl æ¨¡å‹ã€Python æ¨¡å‹ã€Nodejs æ¨¡å¼ã€‚

è°ƒç”¨å¤§è¯­è¨€æ¨¡å‹çš„ API å°±éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯ `api_key`ï¼Œä¸€ä¸ªæ˜¯ `base_url`ã€‚å…¶ä¸­ï¼š

- `base_url` ç”¨äºæŒ‡ç¤ºæˆ‘ä»¬è°ƒç”¨æ˜¯å“ªä¸ªå¹³å°çš„æ¨¡å‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™é‡Œæ˜¯ç”¨æ¥ç¡®å®šæˆ‘ä»¬æ˜¯ä½¿ç”¨çš„ deepseekï¼Œè¿˜æ˜¯ openai è¿˜æ˜¯ Gemini ä¹‹ç±»çš„å¹³å°çš„å¤§æ¨¡å‹ã€‚
- `api_key` å°±æ˜¯æˆ‘ä»¬èŠ±é’±æ‰èƒ½ä¹°åˆ°çš„ä¸œè¥¿ï¼Œç”¨äºç¡®å®šæˆ‘ä»¬ä½¿ç”¨ api çš„è´¦å·ã€‚ä¹Ÿå°±æ˜¯ä½¿ç”¨çš„æ˜¯è°çš„é¢åº¦ã€‚

## Golang è°ƒ DeepSeek API

`requests.json`ï¼š

```json
{
    "messages": [
        {
        "content": "You are a helpful assistant",
        "role": "system"
        },
        {
        "content": "Hi",
        "role": "user"
        }
    ],
    "model": "deepseek-chat",
    "frequency_penalty": 0,
    "max_tokens": 2048,
    "presence_penalty": 0,
    "response_format": {
        "type": "text"
    },
    "stop": null,
    "stream": false,
    "stream_options": null,
    "temperature": 1,
    "top_p": 1,
    "tools": null,
    "tool_choice": "none",
    "logprobs": false,
    "top_logprobs": null
}
```

`main.go`ï¼š

```go
package main

import (
	"fmt"
	"io"
	"net/http"
	"os"
	"strings"
)

func main() {

	url := "https://api.deepseek.com/chat/completions"
	method := "POST"

	// è¯»å– json æ–‡ä»¶å†…å®¹
	jsonBytes, err := os.ReadFile("request.json")
	if err != nil {
		panic(err)
	}

	payload := strings.NewReader(string(jsonBytes))

	client := &http.Client{}
	req, err := http.NewRequest(method, url, payload)

	if err != nil {
		fmt.Println(err)
		return
	}
	req.Header.Add("Content-Type", "application/json")
	req.Header.Add("Accept", "application/json")
	req.Header.Add("Authorization", "Bearer å¯†é’¥å¯†é’¥å¯†é’¥")

	res, err := client.Do(req)
	if err != nil {
		fmt.Println(err)
		return
	}
	defer res.Body.Close()

	body, err := io.ReadAll(res.Body)
	if err != nil {
		fmt.Println(err)
		return
	}
	fmt.Println(string(body))
}

```

è¿è¡Œç»“æœï¼š

```json
{"id":"2dba9597-458f-4869-abe1-382374bdc306","object":"chat.completion","created":1748422906,"model":"deepseek-chat","choices":[{"index":0,"message":{"role":"assistant","content":"Hello! How can I assist you today? ğŸ˜Š"},"logprobs":null,"finish_reason":"stop"}],"usage":{"prompt_tokens":9,"completion_tokens":11,"total_tokens":20,"prompt_tokens_details":{"cached_tokens":0},"prompt_cache_hit_tokens":0,"prompt_cache_miss_tokens":9},"system_fingerprint":"fp_8802369eaa_prod0425fp8"}
```



## DeepSeek API æ–‡æ¡£

### å¯¹è¯éƒ¨åˆ†

#### `message`

åœ¨ Deepseek çš„æ–‡æ¡£ä¸­ï¼ŒAPI è¯·æ±‚çš„ `body` éƒ¨åˆ†é€šå¸¸åŒ…å«ä¸€ä¸ª `message` æ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„ç”±ä¸åŒè§’è‰²çš„æ¶ˆæ¯å¯¹è±¡ç»„æˆã€‚è¿™äº›æ¶ˆæ¯å¯¹è±¡éµå¾ªç±»ä¼¼ OpenAI Chat Completion API çš„è®¾è®¡æ¨¡å‹ï¼Œç”¨äºæ„å»ºå¤šè½®å¯¹è¯çš„ä¸Šä¸‹æ–‡ã€‚

`message` æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ `role` å­—æ®µæ ‡è¯†æ¶ˆæ¯çš„å‘é€è€…è§’è‰²ï¼Œå¸¸è§ç±»å‹åŒ…æ‹¬ï¼š

- `system`ï¼šç³»ç»Ÿæ¶ˆæ¯ï¼Œç”¨äºè®¾ç½®åŠ©æ‰‹çš„è¡Œä¸ºæˆ–èƒŒæ™¯ï¼ˆä¾‹å¦‚æŒ‡ä»¤ã€è§’è‰²è®¾å®šï¼‰ã€‚
- `user`ï¼šç”¨æˆ·æ¶ˆæ¯ï¼Œæ ‡è¯†ç”¨æˆ·çš„è¾“å…¥æˆ–é—®é¢˜ã€‚
- `assistant`ï¼šåŠ©æ‰‹æ¶ˆæ¯ï¼Œè¡¨ç¤ºåŠ©æ‰‹ä¹‹å‰çš„å›å¤ï¼ˆç”¨äºå¤šè½®å¯¹è¯ä¸Šä¸‹æ–‡ï¼‰ã€‚
- `tool`ï¼ˆå¦‚æœ‰æ”¯æŒï¼‰ï¼šå·¥å…·è°ƒç”¨çš„è¿”å›ç»“æœï¼ˆç±»ä¼¼ OpenAI çš„ `function` è§’è‰²ï¼‰ã€‚

æ¯ç§æ¶ˆæ¯ç±»å‹å…±äº«é€šç”¨ç»“æ„ï¼Œä½†å¯èƒ½æœ‰ç‰¹å®šç”¨é€”çš„å­—æ®µã€‚

åœ¨ä»£ç ä¸­ï¼Œå¯ä»¥çœ‹åˆ° `message` è¿™ä¸ªæ•°ç»„ä¸­çš„å¯¹è±¡çš„ `role` éƒ¨åˆ†ï¼Œå°±æ˜¯ `system`ã€`user` ç­‰å››ç§ç±»å‹ä¸­å…¶ä¸­ä¸€ä¸ªã€‚å…¶å®ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªæ¶ˆæ¯æ˜¯å¯¹è°æŒ‡å®šçš„ã€‚åœ¨æˆ‘ä»¬ä¸Šé¢çš„ demo ä¸­ï¼Œå°±æ˜¯å¯¹ç³»ç»ŸæŒ‡å®šï¼Œ`You are a helpful assistant`ï¼Œç„¶åç”¨æˆ·å‘é€çš„è¯·æ±‚å°±æ˜¯ `Hello`ã€‚

ä¹‹åçš„ `content` å­—æ®µå°±æ¯”è¾ƒå¥½ç†è§£ï¼Œå°±æ˜¯è¿™ä¸ªæ¶ˆæ¯å‘é€çš„å†…å®¹æ˜¯ä»€ä¹ˆã€‚æ¯”å¦‚è¯´æˆ‘ä»¬ä¸Šé¢çš„ `demo` ä¸­çš„ `Hello`ã€‚

è¿˜æœ‰ä¸€ä¸ªå­—æ®µå«åš `name`ï¼Œä¹Ÿæ˜¯ä¸€ä¸ª `string` ç±»å‹çš„ã€‚å®˜æ–¹çš„è¯´æ˜æ˜¯ï¼šâ€œå¯ä»¥é€‰å¡«çš„å‚ä¸è€…çš„åç§°ï¼Œä¸ºæ¨¡å‹æä¾›ä¿¡æ¯ä»¥åŒºåˆ†ç›¸åŒè§’è‰²çš„å‚ä¸è€…ã€‚â€è¿™ä¸ªå­—æ®µçš„æ ¸å¿ƒä½œç”¨æ˜¯ï¼šä¸€ä¸ªç”¨æˆ·ä½¿ç”¨å¤šä¸ª AI åŠ©æ‰‹ï¼Œæˆ–è€…æ˜¯å¤šä¸ªç”¨æˆ·ä½¿ç”¨ä¸€ä¸ª AI åŠ©æ‰‹ï¼Œæˆ–è€…æ˜¯å¤šä¸ªç”¨æˆ·ä½¿ç”¨å¤šä¸ª AI åŠ©æ‰‹ã€‚é€šè¿‡ä¸€äº› demo æ¥çœ‹ï¼š

#### `message.name`

é¦–å…ˆä½¿ç”¨ DeepSeek V3 ä½¿ç”¨å¦‚ä¸‹çš„ json è¾“å…¥ï¼š

```json
    "messages": [
        {
            "content": "ä½ æ˜¯ä¸€ä¸ªå®¢æœåŠ©æ‰‹ã€‚",
            "role": "system"
        },
        {
            "content": "æˆ‘çš„è®¢å•çŠ¶æ€æ˜¯ä»€ä¹ˆï¼Ÿ",
            "role": "user",
            "name": "Alice"
        },
        {
            "content": "è‹¹æœçš„è¥å…»ä»·å€¼æ€ä¹ˆæ ·ï¼Ÿ",
            "role": "user",
            "name": "Bob"
        }
    ],
```

è¿è¡Œä»£ç ä¹‹åï¼ŒAI ä¼šè¿”å›å¦‚ä¸‹çš„ä¿¡æ¯ï¼š

>å…³äºæ‚¨çš„é—®é¢˜ï¼š  
>
>1. **è®¢å•çŠ¶æ€æŸ¥è¯¢**ï¼šè¯·æ‚¨æä¾›è®¢å•å·æˆ–ç™»å½•è´¦æˆ·æŸ¥çœ‹ï¼Œä¹Ÿå¯ä»¥è”ç³»å¯¹åº”å¹³å°çš„å®¢æœè·å–æœ€æ–°ä¿¡æ¯ã€‚  
>
>2. **è‹¹æœçš„è¥å…»ä»·å€¼**ï¼š  
>   - **å¯Œå«è†³é£Ÿçº¤ç»´**ï¼šåŠ©æ¶ˆåŒ–ã€ä¿ƒè¿›è‚ é“å¥åº·ã€‚  
>   - **ç»´ç”Ÿç´ C**ï¼šå¢å¼ºå…ç–«åŠ›ï¼ŒæŠ—æ°§åŒ–ã€‚  
>   - **ä½çƒ­é‡**ï¼šçº¦95å¤§å¡/ä¸ªï¼ˆä¸­ç­‰å¤§å°ï¼‰ï¼Œé€‚åˆå¥åº·é¥®é£Ÿã€‚  
>   - **å«é’¾å’ŒæŠ—æ°§åŒ–ç‰©è´¨**ï¼šæœ‰ç›Šå¿ƒè„å¥åº·ã€‚  
>
>å¦‚éœ€å…¶ä»–å¸®åŠ©ï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ï¼ ğŸ˜Š

è™½ç„¶è¯´æ­£ç¡®è¿”å›äº†ï¼Œä½†æ˜¯è¿™å¹¶ä¸æ˜¯æˆ‘æƒ³è¦çš„ã€‚è¿™ç›¸å½“äºæ˜¯å°†è¾“å‡ºå…¨éƒ½å‹ç¼©åˆ°ä¸€èµ·äº†ï¼Œä½†æ˜¯æˆ‘ä»¥ä¸ºå®ƒä¼šå¯¹ä¸åŒçš„è§’è‰²è¾“å‡ºä¸åŒçš„è§£ç­”ã€‚

é‚£ä¹ˆæˆ‘ä»¬æ¢ä¸€ä¸‹å‘¢ï¼š

```json
    "messages": [
        {
            "content": "ä½ æ˜¯ä¸€ä¸ªå®¢æœåŠ©æ‰‹ã€‚è¯·é’ˆå¯¹ä¸åŒçš„ç”¨æˆ·è¿”å›ä¸åŒçš„ç­”æ¡ˆã€‚å›ç­”çš„æ—¶å€™å¸¦ä¸Šä½ å›å¤çš„å®¢æˆ·çš„åå­—ã€‚",
            "role": "system"
        },
        {
            "content": "æˆ‘çš„è®¢å•çŠ¶æ€æ˜¯ä»€ä¹ˆï¼Ÿ",
            "role": "user",
            "name": "Alice"
        },
        {
            "content": "è‹¹æœçš„è¥å…»ä»·å€¼æ€ä¹ˆæ ·ï¼Ÿ",
            "role": "user",
            "name": "Bob"
        }
    ],
```

æœ¬æ¬¡è¾“å‡ºä¿¡æ¯ï¼š

>äº²çˆ±çš„ç”¨æˆ·ï¼Œæ‚¨å¥½ï¼
>
>å…³äºæ‚¨çš„é—®é¢˜ï¼š
>
>1. è®¢å•çŠ¶æ€æŸ¥è¯¢ï¼šå¾ˆæŠ±æ­‰ï¼Œæˆ‘æ— æ³•ç›´æ¥æŸ¥çœ‹æ‚¨çš„è®¢å•çŠ¶æ€ã€‚è¯·æ‚¨æä¾›è®¢å•å·æˆ–ç™»å½•æ‚¨çš„è´¦æˆ·æŸ¥çœ‹æœ€æ–°çŠ¶æ€ã€‚
>2. è‹¹æœçš„è¥å…»ä»·å€¼ï¼šè‹¹æœå¯Œå«ç»´ç”Ÿç´ Cã€è†³é£Ÿçº¤ç»´å’ŒæŠ—æ°§åŒ–ç‰©è´¨ï¼Œæœ‰åŠ©äºæ¶ˆåŒ–å’Œæé«˜å…ç–«åŠ›ã€‚æ¯å¤©ä¸€ä¸ªè‹¹æœå¯¹èº«ä½“å¾ˆæœ‰å¥½å¤„ã€‚
>
>å¦‚æœæ‚¨éœ€è¦è¿›ä¸€æ­¥å¸®åŠ©ï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ã€‚
>
>ç¥æ‚¨ç”Ÿæ´»æ„‰å¿«ï¼

å¥½åƒä¹Ÿå°±æ˜¯å°†ä¸¤ä¸ªé—®é¢˜æ”¾åˆ°ä¸€èµ·å¤„ç†äº†ã€‚å®é™…ä¸Šï¼Œå¦‚æœä¸å¸¦æœ‰è¿™ä¸ª nameï¼Œå¥½åƒè¾“å‡ºçš„ç»“æœä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚

è¿™æ˜¯ DeepSeek V3 çš„è¾“å‡ºç»“æ„ï¼ŒR1 çš„è¾“å‡ºç»“æ„è·Ÿè¿™ä¸ªæœ‰ä¸€äº›ä¸åŒï¼Œä½†æ˜¯è¿˜å¾—é‡æ–°ç¼–å†™ç»“æ„ä½“ï¼Œè¿™é‡Œæˆ‘å°±ä¸é‡æ–°å†™äº†ã€‚

`role`ã€`content`ã€`name` è¿™ä¸‰ä¸ªå­—æ®µæ˜¯ `system` å’Œ `user` è¿™ä¸¤ä¸ªå­—æ®µä½¿ç”¨çš„ï¼Œä½†æ˜¯ `assistant` å’Œ `tool` çš„ä½¿ç”¨ç•¥æœ‰ä¸åŒã€‚å…·ä½“çœ‹[DeepSeekå®˜æ–¹æ–‡æ¡£](https://api-docs.deepseek.com/zh-cn/api/create-chat-completion)ã€‚

#### `model`

å°±æ˜¯æœ¬æ¬¡æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯å“ªä¸ª DeepSeek çš„æ¨¡å‹ã€‚`model` è¿™é‡Œæœ‰ä¸¤ä¸ªé€‰é¡¹ï¼Œåˆ†åˆ«æ˜¯ï¼š

- `deepseek-chat`ï¼Œå¯¹åº” DeepSeek V3ã€‚
- `deepseek-reasoner`ï¼Œå¯¹åº” DeepSeek R1ã€‚

#### `frequency_penalty`

å–å€¼èŒƒå›´æ˜¯ `[-2, 2]`ã€‚å…·ä½“å«ä¹‰æ˜¯ï¼Œå¯¹å·²ç»å‡ºç°è¿‡çš„è¯ï¼Œè¦ä¸è¦æ–½åŠ æƒ©ç½šä»¥åŠæ–½åŠ æƒ©ç½šçš„åŠ›åº¦ã€‚å¦‚æœè¿™ä¸ªå€¼å¤§äº 0ï¼Œé‚£å°±æ˜¯ä¼šå¯¹å·²ç»å‡ºç°è¿‡çš„è¯ï¼ˆtokenï¼‰æ–½åŠ æƒ©ç½šï¼Œä¹‹åä¼šé¿å…å†å‡ºç°è¿™äº›è¯ã€‚

æ¯”å¦‚è¯´åœ¨ä¸ AI çš„å¯¹è¯è¿‡ç¨‹ä¸­ï¼Œä¸Šä¸‹æ–‡ä¸­å·²ç»å¤šæ¬¡å‡ºç°äº†â€œäººå·¥æ™ºèƒ½â€è¿™ä¸ªè¯ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬çš„ `frequency_penalty` è®¾ç½®çš„å€¼æ¯”è¾ƒå¤§ï¼Œä¹‹åæ¨¡å‹å°±ä¼šå¯¹â€œäººå·¥æ™ºèƒ½â€è¿™ä¸ªè¯æ–½åŠ æƒ©ç½šï¼Œåé¢ä¼šå‡ºç°æ›´å°‘çš„â€œäººå·¥æ™ºèƒ½â€ï¼Œè½¬è€Œæ¢æˆæ˜¯â€œAIâ€ã€â€œæœºå™¨å­¦ä¹ â€ä¹‹ç±»çš„è¯è¯­ã€‚ç›¸åï¼Œå¦‚æœæˆ‘ä»¬è®¾ç½®çš„ `frequency_penalty` è®¾ç½®çš„æ˜¯ä¸€ä¸ªè´Ÿæ•°ï¼Œæ¨¡å‹åˆ™ä¼šæ›´é¢‘ç¹åœ°å»é‡å¤â€œäººå·¥æ™ºèƒ½â€ã€‚

æ‰€ä»¥ï¼š

- `frequency_penalty > 0`ï¼šç”Ÿæˆçš„æ–‡æœ¬æ›´å…·æœ‰å¤šæ ·æ€§ï¼Œä½†æ˜¯å¯èƒ½æ¯”è¾ƒè·³è·ƒï¼Œå¯èƒ½ä¼šåç¦»ä¸»é¢˜ã€‚
- `frequency_penalty < 0`ï¼šç”Ÿæˆçš„æ–‡æœ¬æ›´åŠ å›ºå®šï¼Œæ¯”è¾ƒå‡†ç¡®ã€ä¿å®ˆï¼Œä½†æ˜¯å¯èƒ½ä¼šä¸€ç›´å¼ºè°ƒæŸä¸€ä¸ªè¯è¯­ï¼Œè®©å›ç­”æ¯”è¾ƒå†—é•¿ã€‚

å‚æ•°çš„é»˜è®¤å€¼æ˜¯ `0`ï¼Œè¡¨ç¤ºå¯¹ `token` æ²¡æœ‰æƒ©ç½šæˆ–è€…å¥–åŠ±ï¼Œå®Œå…¨ç”±æ¨¡å‹è‡ªå·±æ¥å†³å®šã€‚

#### `max_tokens`

è¿™é‡Œè¯´çš„ `max_tokens` æ˜¯è¾“å‡ºéƒ¨åˆ†çš„ `token` é™åˆ¶ï¼Œè€Œä¸æ˜¯è¾“å…¥ã€‚

ä½†æ˜¯å®é™…ä¸Šä¹Ÿæ˜¯æœ‰ä¸€ä¸ªä¸ç­‰å¼çš„å…³ç³»åœ¨è¾“å…¥å’Œè¾“å‡ºä¹‹é—´çš„ï¼Œå…·ä½“å¯ä»¥è¡¨ç°ä¸ºï¼š
$$
input\_tokens + output\_tokens \leq model\_context\_limit
$$
å…¶ä¸­æåˆ°å‡ ä¸ªå‚æ•°ï¼Œåˆ†åˆ«ä»‹ç»ä¸€ä¸‹ï¼š

- `input_tokens`ï¼šè¾“å…¥çš„å†…å®¹çš„é•¿åº¦ï¼ˆ`tokens`ï¼‰ã€‚
- `output_tokens`ï¼šè¾“å‡ºçš„å†…å®¹çš„é•¿åº¦ï¼ˆè¾“å‡º `tokens`ï¼‰ã€‚
- `model_context_limit`ï¼šæ¨¡å‹å›ºå®šçš„æœ€å¤§ `tokens` æ•°é‡ã€‚è¿™æ˜¯ä¸‰ä¸ªå‚æ•°ä¸­å”¯ä¸€ä¸€ä¸ªä¸å¯å˜çš„å‚æ•°ï¼Œå®Œå…¨ç”±æ‰€ä½¿ç”¨çš„ model å†³å®šã€‚è¿™ä¸ªä¸œè¥¿çš„å•ä½ä¸€èˆ¬éƒ½æ˜¯å¤šå°‘ Kï¼Œæ¯”å¦‚è¯´ `gpt-4-turbo` çš„ä¸Šä¸‹æ–‡é•¿åº¦æœ€å¤šæ˜¯ `128k`ï¼Œ`DeepSeekR1` çš„ä¸Šä¸‹æ–‡é•¿åº¦é™åˆ¶ä¹Ÿæ˜¯ `128K`ã€‚ä½†æ˜¯æˆ‘ä»¬ä¹‹å‰è¯´çš„æ»¡è¡€ç‰ˆ DeepSeek è¯´çš„ `671B` è¯´çš„æ˜¯æ¨¡å‹å†…éƒ¨çš„å‚æ•°é‡ï¼Œè¡¨ç¤ºä¸€ä¸ªæ¨¡å‹çš„å¤æ‚ç¨‹åº¦ï¼Œè·Ÿä¸Šä¸‹æ–‡é•¿åº¦é™åˆ¶ä¸æ˜¯ä¸€ä¸ªä¸œè¥¿ã€‚

äºæ˜¯åœ¨ä¸Šè¿°çš„ä¸ç­‰å¼ä¸­ï¼Œ`model_context_limit` è¿™ä¸ªå‚æ•°å·²ç»å›ºå®šæ­»äº†ï¼Œ`output_tokens` åˆæ˜¯æ¨¡å‹çš„è¿”å›å€¼æˆ‘ä»¬è‡ªå·±åªèƒ½ç¡®å®šä¸€ä¸ª `input_tokens`ã€‚åœ¨ç¡®å®šå¥½äº† `input_tokens` ä¹‹åï¼Œ`output_tokens` å°±ä¼šæœ‰ä¸€ä¸ªä¸Šé™å€¼ã€‚

ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬ä¸€ä¸ªæ¨¡å‹çš„ä¸Šä¸‹æ–‡é™åˆ¶æ˜¯ 8192ï¼Œç„¶ååœ¨è¾“å…¥çš„æ—¶å€™ï¼Œæˆ‘ä»¬çš„è¾“å…¥ `token` å·²ç»è¾¾åˆ°äº† 5000ã€‚é‚£ä¹ˆè¾“å‡ºçš„æ—¶å€™ï¼Œè¾“å‡ºçš„æœ€å¤§ `token` å°±æ˜¯ 3192ã€‚

è¯´åˆ°ç°åœ¨å¥½åƒè¿˜æ²¡æœ‰æåˆ°ä¸Šé¢è¯´çš„ `max_tokens`ã€‚å®é™…ä¸Šè¿™æ˜¯ä¸€ä¸ªåŒé‡é™åˆ¶ï¼Œä¸Šé¢çš„ä¸ç­‰å¼å’Œè¿™ä¸ª `max_tokens` ä¸€èµ·é™åˆ¶è¾“å‡ºï¼Œè®©è¾“å‡ºä¸è¦å¤ªé•¿äº†ã€‚ç”¨ä»£ç è¡¨æ˜å¯ä»¥æ˜¯ï¼š

```go
output_tokens = min(max_tokens, model_context_limit - input_tokens)
```

æ‰€ä»¥è¯´å¦‚æœè¾“å…¥ç‰¹åˆ«é•¿ï¼Œå¯èƒ½ä¼šæŒ¤å‹è¾“å‡ºçš„é•¿åº¦ã€‚ä½†æ˜¯è¿™é€šå¸¸ä¸æ˜¯ä¸»è¦çš„åŸå› ï¼Œå› ä¸ºå¤§éƒ¨åˆ†æ—¶å€™ä¸Šé™éƒ½æ˜¯å¡åœ¨ `max_tokens` çš„é™åˆ¶ï¼Œè¿™ä¸ªå‚æ•°è®©æˆ‘ä»¬çš„è¾“å‡ºä¸ä¼šç‰¹åˆ«é•¿ã€‚

åœ¨ DeepSeek ä¸­ï¼Œ`max_tokens` å‚æ•°çš„å–å€¼åŒºé—´æ˜¯ `[1, 8192]`ï¼Œé»˜è®¤å€¼æ˜¯ `4096`ã€‚

#### å¤šè½®å¯¹è¯ä¸ `input_tokens`

ä¸Šé¢æ€»ç»“è¯´ `input_tokens` å°±æ˜¯è¾“å…¥çš„æ–‡æœ¬çš„é•¿åº¦ï¼Œä½†æ˜¯æˆ‘è§‰å¾—è¿˜åº”è¯¥è·Ÿä¹‹å‰çš„å¯¹è¯å†…å®¹æœ‰å…³ç³»ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ `DeepSeek` ç½‘é¡µä¸­ï¼Œå¦‚æœä¸€ç»„å¯¹è¯å‰é¢å·²ç»æœ‰å¾ˆé•¿äº†ï¼Œé‚£ä¹ˆåé¢çš„è¾“å‡ºä¹Ÿä¼šè¢«å‰é¢çš„è¾“å…¥æŒ¤å‹ã€‚ä½†æ˜¯åœ¨æˆ‘è‡ªå·±çš„ Coding æ–¹é¢ï¼Œæ¯æ¬¡è°ƒ API çš„æ—¶å€™ï¼Œè¿˜æ˜¯æ— æ³•å®ç°å‡ºç½‘é¡µç«¯å¤šè½®å¯¹è¯çš„æ•ˆæœï¼Œè¿™ä¸€ç‚¹è®©æˆ‘æ¯”è¾ƒç–‘æƒ‘ã€‚

é€šè¿‡æŸ¥æ–‡æ¡£å‘ç°ï¼ŒOpenAI çš„ API æœ¬èº«æ˜¯æ— çŠ¶æ€çš„ï¼Œä¹Ÿå°±æ˜¯ä¸ä¿å­˜çŠ¶æ€ã€ä¸ä¿å­˜å†å²è®°å½•çš„ã€‚

æ‰€ä»¥å¦‚æœè¦è¿›è¡Œå¤šè½®çš„å¯¹è¯ï¼Œå°±è¦å¼€å‘è€…æ˜¾ç¤ºä¼ å…¥å®Œæ•´çš„å¯¹è¯å†å²ã€‚è¿™ä¸ªå¯¹è¯å†å²åŒ…æ‹¬å¼€å‘è€…å‰é¢è¾“å…¥çš„å†…å®¹ï¼Œè¿˜æœ‰æ¨¡å‹ç»™å‡ºçš„è¾“å‡ºå†…å®¹ã€‚å°†æ‰€æœ‰çš„å†…å®¹éƒ½æ”¾åˆ°ä¸€ä¸ª `messages` ä¸­ï¼Œå†å°†è¿™ä¸ª `messages` ä¼ ç»™ APIã€‚

è¿™å°±åƒæ˜¯ï¼š

```json
{
  "model": "gpt-4",
  "messages": [
    {"role": "user", "content": "ç¬¬ä¸€è½®é—®é¢˜"},
    {"role": "assistant", "content": "æ¨¡å‹çš„ç¬¬ä¸€è½®å›å¤"},
    {"role": "user", "content": "æ–°çš„é—®é¢˜"} // åŒ…å«å†å²å†…å®¹
  ]
}
```

å¥—åˆ°æˆ‘ä»¬ä¹‹å‰çš„ golang çš„ json ç»“æ„ä½“ä¸­ï¼Œç¬¬ä¸€æ¬¡çš„ç»“æ„ä½“æˆ‘ä»¬è¿™æ ·å†™ï¼š

```json
    "messages": [
        {
            "content": "ä½ æ˜¯ä¸€ä¸ªé€šç”¨çš„AIåŠ©æ‰‹ï¼Œå¾ˆæ“…é•¿ä¸ºæˆ‘è§£ç­”é—®é¢˜ã€‚",
            "role": "system"
        },
        {
            "content": "ä½ å¯ä»¥ä¸ºæˆ‘è®²ä¸€ä¸ªç®€å•çš„ç¬‘è¯å—ï¼Ÿ",
            "role": "user"
        }
    ],
```

ç¬¬ä¸€æ¬¡è°ƒç”¨ä¹‹åï¼ŒAI ç»™å‡ºäº†å®ƒçš„å›å¤ï¼Œè¿™æ¬¡æˆ‘ä»¬å°† AI çš„å›å¤ï¼Œä»¥åŠæˆ‘ä»¬çš„ç¬¬äºŒä¸ªé—®é¢˜ï¼Œé‡æ–°ä¼ ç»™ AIï¼š

```json
    "messages": [
        {
            "content": "ä½ æ˜¯ä¸€ä¸ªé€šç”¨çš„AIåŠ©æ‰‹ï¼Œå¾ˆæ“…é•¿ä¸ºæˆ‘è§£ç­”é—®é¢˜ã€‚",
            "role": "system"
        },
        {
            "content": "ä½ å¯ä»¥ä¸ºæˆ‘è®²ä¸€ä¸ªç®€å•çš„ç¬‘è¯å—ï¼Ÿ",
            "role": "user"
        },
        {
            "content": "å½“ç„¶å¯ä»¥ï¼è¿™é‡Œæœ‰ä¸€ä¸ªç®€å•çš„ç¬‘è¯ï¼š\n\n**ä¸ºä»€ä¹ˆæ•°å­¦ä¹¦æ€»æ˜¯å¾ˆå¿§éƒï¼Ÿ**  \nâ€”â€”å› ä¸ºå®ƒæœ‰å¤ªå¤šâ€œé—®é¢˜â€è¦è§£å†³ï¼  \n\nå¸Œæœ›è¿™ä¸ªç¬‘è¯èƒ½è®©ä½ ç¬‘ä¸€ç¬‘ï¼ ğŸ˜„",
            "role": "assistant"
        },
        {
            "content": "è¿™ä¸ªç¬‘è¯çš„ç¬‘ç‚¹åœ¨å“ªé‡Œï¼Ÿ",
            "role": "user"
        }
    ],
```

æˆ‘ä»¬è¿˜å¯ä»¥ç»§ç»­ï¼š

```json
    "messages": [
        {
            "content": "ä½ æ˜¯ä¸€ä¸ªé€šç”¨çš„AIåŠ©æ‰‹ï¼Œå¾ˆæ“…é•¿ä¸ºæˆ‘è§£ç­”é—®é¢˜ã€‚",
            "role": "system"
        },
        {
            "content": "ä½ å¯ä»¥ä¸ºæˆ‘è®²ä¸€ä¸ªç®€å•çš„ç¬‘è¯å—ï¼Ÿ",
            "role": "user"
        },
        {
            "content": "å½“ç„¶å¯ä»¥ï¼è¿™é‡Œæœ‰ä¸€ä¸ªç®€å•çš„ç¬‘è¯ï¼š\n\n**ä¸ºä»€ä¹ˆæ•°å­¦ä¹¦æ€»æ˜¯å¾ˆå¿§éƒï¼Ÿ**  \nâ€”â€”å› ä¸ºå®ƒæœ‰å¤ªå¤šâ€œé—®é¢˜â€è¦è§£å†³ï¼  \n\nå¸Œæœ›è¿™ä¸ªç¬‘è¯èƒ½è®©ä½ ç¬‘ä¸€ç¬‘ï¼ ğŸ˜„",
            "role": "assistant"
        },
        {
            "content": "è¿™ä¸ªç¬‘è¯çš„ç¬‘ç‚¹åœ¨å“ªé‡Œï¼Ÿ",
            "role": "user"
        },
        {
            "content": "è¿™ä¸ªç¬‘è¯çš„ç¬‘ç‚¹åœ¨äºåˆ©ç”¨äº†â€œé—®é¢˜â€ä¸€è¯çš„åŒå…³æ„ä¹‰ï¼š\n\n1. **å­—é¢æ„ä¹‰**ï¼šæ•°å­¦ä¹¦é‡Œç¡®å®å……æ»¡äº†éœ€è¦è§£å†³çš„æ•°å­¦é—®é¢˜ï¼ˆé¢˜ç›®ã€ä¹ é¢˜ï¼‰ã€‚\n2. **å¼•ç”³ä¹‰**ï¼šæ—¥å¸¸ç”¨è¯­ä¸­ï¼Œâ€œæœ‰å¤ªå¤šé—®é¢˜â€ä¹Ÿå¯ä»¥å½¢å®¹ä¸€ä¸ªäººçƒ¦æ¼å¤šã€æƒ…ç»ªä½è½ï¼ˆæ¯”å¦‚ï¼šâ€œä»–æœ€è¿‘é—®é¢˜å¾ˆå¤šâ€ï¼‰ã€‚\n\né€šè¿‡æŠŠæ•°å­¦ä¹¦æ‹ŸäººåŒ–ï¼ˆå¿§éƒï¼‰ï¼Œå°†å®¢è§‚çš„â€œæ•°å­¦é¢˜ç›®â€å’Œä¸»è§‚çš„â€œçƒ¦æ¼â€å·§å¦™æŒ‚é’©ï¼Œåˆ¶é€ äº†ä¸€ç§åå·®å¹½é»˜ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯è®©ä¹¦æœ¬åƒäººä¸€æ ·â€œæŠ±æ€¨å·¥ä½œå¤ªå¤šâ€ï¼Œä»è€Œæ˜¾å¾—å¯çˆ±åˆå¥½ç¬‘ã€‚\n\nç±»ä¼¼é€»è¾‘çš„ç¬‘è¯è¿˜æœ‰ï¼š  \n**â€œä¸ºä»€ä¹ˆç”µè„‘å¾ˆå†·ï¼Ÿâ€**  \nâ€”â€”å› ä¸ºå®ƒæ€»æ˜¯å¼€ç€Windowsï¼ˆçª—æˆ·ï¼‰ï¼  \n\nï¼ˆè¿™ç§ç¬‘è¯é€‚åˆå–œæ¬¢â€œå†·å¹½é»˜â€æˆ–æ–‡å­—æ¸¸æˆçš„äººğŸ˜‰",
            "role": "assistant"
        },
        {
            "content": "ç”¨å¤§ç™½è¯é‡è¿°ä¸€éã€‚",
            "role": "user"
        }
    ],
```

AI æœ€åå›ç­”è¯´ï¼š

> å“ˆå“ˆï¼Œè¯´ç™½äº†å°±æ˜¯ï¼š  
>
> æ•°å­¦ä¹¦é‡Œå…¨æ˜¯â€œé¢˜ç›®â€ï¼ˆ1+1=ï¼Ÿè¿™ç§ï¼‰ï¼Œä½†â€œé¢˜ç›®â€è¿™ä¸ªè¯ä¹Ÿèƒ½ç”¨æ¥å½¢å®¹â€œçƒ¦å¿ƒäº‹â€ã€‚  
>
> ç¬‘è¯æ•…æ„æŠŠä¹¦å½“æˆäººï¼Œå‡è£…å®ƒå› ä¸ºâ€œé¢˜ç›®å¤ªå¤šâ€è€Œå‘æ„â€”â€”å°±åƒä½ ä½œä¸šå†™ä¸å®Œæ—¶çš„å¿ƒæƒ…ä¸€æ ·ï¼  
>
> **ä¸¾ä¸ªæ —å­ğŸŒ°ï¼š**  
>
> ä½ å¦ˆè¯´ï¼šâ€œä½ é—®é¢˜å¾ˆå¤šè¯¶ï¼â€ å…¶å®æ˜¯åœ¨éª‚ä½ äº‹å„¿å¤šï¼Œä¸æ˜¯çœŸè®©ä½ åšæ•°å­¦é¢˜ã€‚  
>
> ç¬‘è¯å°±æ˜¯æŠŠè¿™ä¸¤å±‚æ„æ€æ‹§åœ¨ä¸€èµ·ï¼Œé€—ä½ ç©å‘¢ï¼  
>
> ï¼ˆæ˜¯ä¸æ˜¯åƒâ€œå°æ˜æ¯å¤©èµ°è·¯ä¸Šå­¦â€”â€”å› ä¸ºä»–ä¸ä¼šé£â€ä¸€æ ·æ— èŠåˆå¥½ç¬‘ï¼ŸğŸ˜†ï¼‰

å¾ˆæ˜æ˜¾è¿™å°±æ˜¯ä¸€ä¸ªå¤šè½®å¯¹è¯ï¼Œæ¯æ¬¡ AI å›ç­”çš„é—®é¢˜ï¼Œéƒ½ä¼šå—åˆ°ä¹‹å‰æ‰€æœ‰è¾“å…¥çš„å½±å“ã€‚

é‚£ä¹ˆå†å²è®°å½•å¦‚ä½•è®¡å…¥ tokens å‘¢ï¼Ÿå…¶å®å°±æ˜¯æ‰€æœ‰çš„å†å²è®°å½•éƒ½ä¼šä»¥ `input` çš„å½¢å¼è®¡å…¥ tokensï¼Œæ‰€æœ‰çš„å†å²è®°å½•ï¼Œéƒ½ä¼šæ”¾åˆ° `messages` æ•°ç»„ä¸­ï¼Œå…¨éƒ¨éƒ½ä¼ ç»™ APIã€‚åœ¨ç½‘é¡µç«¯ï¼Œå¦‚æœæˆ‘ä»¬å·²ç»å’Œ AI èŠäº† 200 `tokens` çš„å†…å®¹ï¼Œæ¥ä¸‹æ¥ä¸€æ¬¡è¾“å…¥ï¼Œæˆ‘ä»¬è¾“å…¥äº† 50 `tokens` çš„æ–‡æœ¬ï¼Œé‚£ä¹ˆæœ¬æ¬¡ä¸€å…±ç»™ AI ä¼ è¿‡å»çš„ `input_tokens` å°±ä¸€å…±æ˜¯ `200 + 50 = 250 tokens`ã€‚

è¿™æ ·çš„è¯ä¹Ÿå°±èƒ½ç†è§£ä¸ºä»€ä¹ˆä¸€è½®å¯¹è¯ç´¯è®¡å¤ªå¤šä¹‹åï¼ŒAI çš„è¾“å‡ºä¼šè¶Šæ¥è¶Šå°‘ï¼Œåé¢ä¼šè¢«ä¸¥é‡æŒ¤å‹ï¼š

| è½®æ¬¡     | è¾“å…¥ token ç´¯è®¡                                              | è¾“å‡º token ç´¯è®¡      |
| -------- | ------------------------------------------------------------ | -------------------- |
| ç¬¬ 1 è½®  | ç”¨æˆ·è¾“å…¥ 100ï¼Œæ‰€ä»¥å°±æ˜¯ 100                                   | 4096 - 100 = 3996    |
| ç¬¬ 2 è½®  | ä¸Šä¸€æ¬¡å¯¹è¯ API è¿”å› 150ï¼Œæœ¬æ¬¡æˆ‘ä»¬å†é—®ä¸€ä¸ª 100 çš„é—®é¢˜ï¼Œæ‰€ä»¥æœ¬æ¬¡çš„è¾“å…¥ä¸€å…±æ˜¯ï¼š100 + 150 + 100 = 350tokens | 4096 - 350 = 3746    |
| ç¬¬ 10 è½® | ä¹‹å‰æ‰€æœ‰çš„é—®ç­”ä¸Šä¸‹æ–‡ + æœ¬æ¬¡è¾“å…¥çš„ tokensï¼Œä¸€å…±æ˜¯ 4000 tokens | **4096 - 4000 = 96** |

å¯ä»¥çœ‹åˆ°ï¼Œåé¢è¾“å‡ºä¼šè¢«ä¸¥é‡æŒ¤å‹ï¼

æ‰€ä»¥æˆ‘ä»¬åœ¨ä¸€äº›å¤§æ¨¡å‹å¹³å°ä¸Šä½¿ç”¨çš„æ—¶å€™ï¼Œä¹Ÿä¼šæœ‰ä¸€äº›é€‰é¡¹ï¼Œè®©æˆ‘ä»¬å¯ä»¥ã€Œåªä¿ç•™æœ€è¿‘çš„ä¸‰æ¬¡å¯¹è¯ã€ã€‚å…¶å®ä¹Ÿå°±æ˜¯è®© `messages` æ•°ç»„ä¸è¦å˜å¾—å¤ªé•¿ï¼Œåªä¿ç•™æœ€è¿‘çš„å‡ æ¬¡å°±è¡Œã€‚

æˆ–è€…æ˜¯æˆ‘ä»¬ä¹Ÿå¯ä»¥è®© `messages` ä¸­çš„ä¸Šä¸‹æ–‡ä¿¡æ¯å˜å¾—ç²¾ç®€ä¸€äº›ï¼Œæ¯”å¦‚è¯´è™½ç„¶ AI ä¹‹å‰ç»™æˆ‘ä»¬å›å¤äº†å¾ˆå¤šçš„ä¸œè¥¿ï¼Œä½†æ˜¯æˆ‘ä»¬å°† AI å›å¤çš„å¾ˆå¤šå†…å®¹ç»™ç¼©çŸ­æˆå¾ˆçŸ­çš„ä¸€æ®µè¯ã€‚

æ‰€ä»¥è¿™ä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨ DeepSeek ä¹‹ç±»çš„ç½‘é¡µèŠå¤©ä¸­ï¼ŒèŠåˆ°ä¸­é€”ç«Ÿç„¶è¿˜èƒ½æ¢æ¨¡å‹ï¼å°†å¯¹è¯æ¨¡å‹ç”±ä¹‹å‰çš„ `DeepSeek V3` æ¢æˆ `DeepSeek R1`ï¼Œå…¶å®å°±æ˜¯æŠŠç›¸åŒçš„å‚æ•°å‘ç»™äº†å¦ä¸€ä¸ª AI è€Œå·²ã€‚

#### `presence_penalty`

å–å€¼çš„èŒƒå›´æ˜¯ `[-2, 2]`ï¼Œé»˜è®¤å€¼æ˜¯ `0`ã€‚

ä¸ç®¡æ˜¯ä»è¡¨é¢ä¸Šçœ‹ï¼Œè¿˜æ˜¯ä»åŠŸèƒ½çš„æè¿°ä¸Šçœ‹ï¼Œéƒ½æ„Ÿè§‰è¿™ä¸ª `presence_penalty` å’Œä¹‹å‰çš„ `frequency_penalty` å·®ä¸å¤šã€‚åæ¥å‘ç°ï¼Œè¿™ä¸¤ä¸ªè™½ç„¶éƒ½æ˜¯å¯¹ä¹‹å‰çš„æ–‡æœ¬æ·»åŠ æƒ©ç½šçš„å‚æ•°ï¼Œä½†æ˜¯ä¸€ä¸ªé‡ç‚¹åœ¨**å­˜åœ¨**ï¼Œå¦ä¸€ä¸ªé‡ç‚¹åœ¨**é¢‘ç‡**ã€‚

é€šè¿‡ä¸¾ä¾‹è¯´æ˜ï¼Œå¦‚æœè¯´æˆ‘ä»¬çš„ `presence_penalty` è®¾ç½®çš„æ˜¯ä¸€ä¸ªæ­£æ•°ï¼Œé‚£ä¹ˆå¯¹äºä¸€ä»½ä¹‹å‰çš„å¯¹è¯ï¼Œå¦‚æœå·²ç»å‡ºç°è¿‡ã€Œäººå·¥æ™ºèƒ½ã€è¿™ä¸ªè¯è¯­ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªè¯è¯­å·²ç»å‡ºç°è¿‡äº†ï¼Œä¹‹åçš„ç”Ÿæˆçš„è¾“å‡ºä¸­ï¼Œå°±ä¼šå°½å¯èƒ½çš„å»é¿å…å†æ¬¡å‡ºç°ã€Œäººå·¥æ™ºèƒ½ã€è¿™ä¸ªè¯è¯­ã€‚æƒ©ç½šçš„æ˜¯ä¸€ä¸ªå›ºå®šçš„å€¼ï¼Œå°±æ˜¯ä¸€ä¸ªç®€å•çš„é»‘åå•ï¼Œå¦‚æœä½ å‡ºç°è¿‡ï¼Œå°±ç”Ÿæ•ˆä¸€æ¬¡ä¸”ä»…ç”Ÿæ•ˆä¸€æ¬¡ï¼›å¦‚æœä½ è¿˜æ²¡å‡ºç°è¿‡ï¼Œå°±ä¸ç”Ÿæ•ˆã€‚

ä½†æ˜¯æˆ‘ä»¬ä¹‹å‰è°ˆè¿‡çš„ `frequency_penalty` è¯´çš„æ˜¯é¢‘ç‡ã€‚æ¯”å¦‚è¯´ä¹‹å‰çš„ä¸Šä¸‹æ–‡ä¸­å‡ºç°è¿‡ã€Œäººå·¥æ™ºèƒ½ã€è¿™ä¸ªè¯è¯­ï¼Œå¤§æ¨¡å‹å°±ä¼šè®°ä½è¿™ä¸ªè¯è¯­å‡ºç°è¿‡å¤šå°‘æ¬¡ï¼Œå‡ºç°çš„æ¬¡æ•°è¶Šå¤šï¼Œç½šçš„è¶Šç‹ ï¼Œä¹‹åå†å‡ºç°çš„æ¦‚ç‡ä¹Ÿæ›´å°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœåªå‡ºç°è¿‡ä¸€æ¬¡ï¼Œé‚£ä¹ˆå…¶å®ç»™çš„æƒ©ç½šå°±å¹¶ä¸æ˜¯å¾ˆé«˜ï¼Œä½†æ˜¯å¦‚æœåé¢å†å‡ºç°ï¼Œè¿™ä¸ªæƒ©ç½šä¼šè¶Šæ¥è¶Šé«˜ï¼Œç›´åˆ°åé¢å†ä¹Ÿä¸ä¼šå‡ºç°è¿™ä¸ªè¯è¯­äº†ã€‚

æœ‰ç‚¹åƒæ˜¯ï¼Œ`presence` æ˜¯ä¸€ä¸ªå¸ƒå°”ç±»å‹çš„å˜é‡ï¼Œä½ å‡ºç°å°±æ˜¯ `true`ï¼Œä¸å‡ºç°å°±æ˜¯ `false`ï¼Œä½†æ˜¯å‡ºç°äº†å¤šå°‘æ¬¡æˆ‘å¹¶ä¸æ˜¯å¾ˆå…³å¿ƒã€‚ä½†æ˜¯ `frequency` å°±æ˜¯ï¼Œåƒæ˜¯ä¸€ä¸ª `int` ç±»å‹ï¼Œæˆ‘ä¼šå…³å¿ƒä½ å‡ºç°çš„æ¬¡æ•°æ˜¯å¤šå°‘ã€‚

æ€»ç»“ï¼š`presence_penalty` çš„å‡ºç°æ˜¯ä¸ºäº†è®©æˆ‘ä»¬çš„å¯¹è¯èƒ½å¤Ÿã€Œå‡ºç°æ–°ä¸»é¢˜ã€ï¼Œä½†æ˜¯ `frequency_penalty` çš„å‡ºç°æ„ä¹‰åœ¨äºåœ¨æˆ‘ä»¬çš„å¯¹è¯ä¸­ã€ŒæŠ‘åˆ¶é«˜é¢‘è¯ã€ã€‚

#### `response_format`

AI å¤§æ¨¡å‹è¿”å›çš„è¾“å‡ºçš„ç±»å‹ï¼Œæä¾›äº†ä¸¤ç§å–å€¼ï¼š`text` å’Œ `json_object`ã€‚é»˜è®¤æ˜¯ `text`ï¼Œä¹Ÿå°±æ˜¯è¿”å›æ–‡æœ¬å†…å®¹ã€‚

å¦‚æœæŒ‡å®š `json-object` çš„è¯ï¼Œæ¨¡å‹ä¼š**å°½æœ€å¤§åŠªåŠ›**è¿”å›ä¸€ä¸ª JSON çš„ç»“æ„ä½“ã€‚è¿™æ ·ä¼šæœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿä¸€äº›ç½‘ç»œæ¡†æ¶å¯èƒ½å°±ç›´æ¥ç”¨è¿”å›çš„ JSON æ¡†æ¶å»åµŒå…¥åˆ°ä¸€äº›ä»£ç ä¸­ï¼Œè¿™æ ·ä¼šè®©å¼€å‘æ›´ç®€å•äº›ã€‚

ä½†æ˜¯éœ€è¦æ³¨æ„ï¼š

1. å¦‚æœçœŸè¦è¿™æ ·åšï¼Œå•çº¯åœ¨è¿™é‡ŒæŒ‡å®š `json_object` ä¸ºè¿”å›çš„ç±»å‹æ˜¯ä¸å¤Ÿçš„ï¼Œå› ä¸ºè™½ç„¶ä½ æŒ‡å®šè¾“å‡ºç±»å‹ä¸º `json` ç±»å‹ï¼Œä½†æ˜¯å‘¢ï¼Œ`json` æ˜¯æœ‰ç»“æ„çš„å‘€ï¼ä½ è¦ä¸€ä¸ªä»€ä¹ˆæ ·çš„ `json`ï¼Œä½ çš„ `json` ä¸­éœ€è¦å“ªå‡ ä¸ªå­—æ®µï¼Œæ¯ä¸ªå­—æ®µçš„ç±»å‹ã€å–å€¼èŒƒå›´æ˜¯å¤šå°‘ï¼Ÿè¿™äº›éƒ½æ²¡æœ‰è¯´ã€‚
2. å› ä¸ºè¾“å‡º `json` ä¼šæ¯”è¾ƒå¤šï¼Œæ‰€ä»¥åœ¨æ¥æ”¶åˆ°è¿”å›å€¼çš„æ—¶å€™ï¼Œéœ€è¦çœ‹çœ‹è¿”å›å€¼ç±»å‹å‚æ•°ä¸­çš„ `finish_reason`ï¼Œå¦‚æœæ˜¯ `length`ï¼Œé‚£å°±è¦æ³¨æ„äº†ï¼Œæ˜¯ä¸æ˜¯æœ¬æ¥ AI å¯ä»¥ç”Ÿæˆæ›´å¤šï¼Œä½†æ˜¯å—é™äºé•¿åº¦ï¼Œè¢«æˆªæ–­äº†ã€‚é‚£ `json` ä½œä¸ºä¸€ä¸ªè¯­æ³•è¿˜æ¯”è¾ƒä¸¥æ ¼çš„ç»“æ„ä½“ï¼Œä»ä¸­é—´ç›´æ¥æˆªæ–­å†ç›´æ¥éƒ¨ç½²åˆ°ä»£ç é‡Œï¼Œè¿™ä¼šå¯¼è‡´ä¸¥é‡çš„é”™è¯¯ã€‚

è¿™ä¸ªå€¼åœ¨è¯·æ±‚çš„æ—¶å€™å¯ä»¥ä¸è®¾ç½®æˆ–è€…è®¾ç½®ä¸ºç©ºï¼Œè¿™æ ·ä¼šä½¿ç”¨é»˜è®¤å€¼ `text`ã€‚

#### `stop`

æ§åˆ¶æ–‡æœ¬ç”Ÿæˆä¸­ï¼Œå¦‚æœè¾“å‡ºä»€ä¹ˆè¯ä¹‹åï¼Œå°±ä¸­æ–­ç”Ÿæˆã€‚

æœ‰ä¸¤ç§æ¥æ”¶ç±»å‹ï¼š

- `string`ï¼Œå•ä¸ªå­—ç¬¦ä¸²
- `[]string`ï¼Œå­—ç¬¦ä¸²åˆ—è¡¨ï¼Œå°±æ˜¯å¾ˆå¤šä¸ªå­—ç¬¦ä¸²

å¤§æ¦‚æƒ³åˆ°å‡ ä¸ªç”¨é€”ï¼š

- æˆ‘ä»¬å¯ä»¥è®¾ç½® `\n` ä¸º `stop` çš„å­—ç¬¦ä¸²ï¼Œè¿™æ ·å¯ä»¥ä¿è¯è¾“å‡ºä¸­è‚¯å®šåªä¼šæœ‰ä¸€æ®µè¯ã€‚
- è®¾ç½® `end`ã€`End`ã€`ç»“æŸ` ä¹‹ç±»çš„å…³é”®å­—ï¼Œå¯ä»¥è®©è¾“å‡ºä¸­å‡ºç°è¿™æ ·çš„è¯ä¹‹åï¼Œå°±ç«‹é©¬ç»“æŸï¼ˆè™½ç„¶ä¸çŸ¥é“è¿™æ ·åšçš„æ„ä¹‰â€¦â€¦ï¼‰ã€‚
- å±è”½ä¸€äº›ç¢°éƒ½ä¸èƒ½ç¢°çš„æ»‘æ¢¯ï¼Ÿ

æ¯”å¦‚è¯´æˆ‘ä»¬è¿˜æ˜¯è®¾ç½®ï¼š

```json
    "messages": [
        {
            "content": "ä½ æ˜¯ä¸€ä¸ªé€šç”¨çš„AIåŠ©æ‰‹ï¼Œå¾ˆæ“…é•¿ä¸ºæˆ‘è§£ç­”é—®é¢˜ã€‚",
            "role": "system"
        },
        {
            "content": "ä½ å¯ä»¥ä¸ºæˆ‘è®²ä¸€ä¸ªç®€å•çš„ç¬‘è¯å—ï¼Ÿ",
            "role": "user"
        }
    ],
	// ......
    "stop": "ç¬‘è¯",
```

ç„¶å AI ä¼šè¾“å‡ºï¼š

>å½“ç„¶å¯ä»¥ï¼è¿™é‡Œæœ‰ä¸€ä¸ªç®€å•çš„

è¿™ä¸ªå‚æ•°çš„å–å€¼é»˜è®¤æ˜¯ `null`ã€‚

> åè®°ï¼š
>
> ![image-20250529173500606](https://xubowen-bucket.oss-cn-beijing.aliyuncs.com/img/image-20250529173500606.png)
>
> CherryStudio ä¸­ï¼ŒDeepSeek ä¸Šé¢è¿˜åœ¨è¯´è¿™ç§åšæ³•å­˜åœ¨ä¸¥é‡ç¼ºé™·ï¼Œä½†æ˜¯åé¢åˆæŠŠè‡ªå·±çš„å›ç­”ææ–­äº†ã€‚ä»Šå¤©è§åˆ°çš„æœ€å¥½ç¬‘çš„ç¬‘è¯ğŸ¤£ã€‚

#### `stream`

å°±æ˜¯è¾“å‡ºçš„æ—¶å€™è¦ä¸è¦ä½¿ç”¨æµå¼è¾“å‡ºã€‚å¦‚æœä½¿ç”¨æµå¼è¾“å‡ºï¼Œè¾“å‡ºçš„å†…å®¹å°±æ˜¯ä¸€æ®µä¸€æ®µçš„ï¼ŒAI è¾“å‡ºçš„å†…å®¹ä¸ä¼šæ‰“åŒ…æˆå®Œæ•´çš„ä¸€æ®µè¯å†è¿”å›ï¼Œè€Œæ˜¯æ¯ç”Ÿæˆä¸€ä¸ª token å°±è¿”å›ä¸€æ¬¡ã€‚

ä¾‹å¦‚è¯´ï¼Œæˆ‘ä»¬ä½¿ç”¨å¦‚ä¸‹çš„ golang æ¥æ”¶æ–¹å¼ï¼š

```go
	res, err := client.Do(req)
	if err != nil {
		fmt.Println(err)
		return
	}
	defer res.Body.Close()

	body, err := io.ReadAll(res.Body)
	if err != nil {
		fmt.Println(err)
		return
	}
```

é‚£ä¹ˆä¹‹å `body` ä¸­å°±ä¼šæŒç»­å—åˆ°æ•°æ®å—ï¼Œæœ€åå°†æ‰€æœ‰æ•°æ®å—æ‹¼æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ¯ä¸ªæ•°æ®å—éƒ½æ˜¯ä»¥ `data:` å¼€å¤´ï¼Œæ•°æ®å—ä¹‹é—´ç”¨ `\n\n` æ¥è¿æ¥ã€‚æœ€åï¼Œå†è¾“å‡ºä¸€ä¸ª `data: [NONE]`ã€‚

ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¦‚æœä½¿ç”¨ `fmt.Println(string(body))`ï¼Œä¼šå‘ç° `body` ä¸­çš„æ•°æ®å¤§æ¦‚æ˜¯ï¼š

```go
data: {"id":"728c5695-1c40-4d02-8a60-d7ebd3cf7590","object":"chat.completion.chunk","created":1748586048,"model":"deepseek-chat","system_fingerprint":"fp_8802369eaa_prod0425fp8","choices":[{"index":0,"delta":{"role":"assistant","content":""},"logprobs":null,"finish_reason":null}]}

data: {"id":"728c5695-1c40-4d02-8a60-d7ebd3cf7590","object":"chat.completion.chunk","created":1748586048,"model":"deepseek-chat","system_fingerprint":"fp_8802369eaa_prod0425fp8","choices":[{"index":0,"delta":{"content":"å½“ç„¶"},"logprobs":null,"finish_reason":null}]}

data: {"id":"728c5695-1c40-4d02-8a60-d7ebd3cf7590","object":"chat.completion.chunk","created":1748586048,"model":"deepseek-chat","system_fingerprint":"fp_8802369eaa_prod0425fp8","choices":[{"index":0,"delta":{"content":"å¯ä»¥"},"logprobs":null,"finish_reason":null}]}

// ...
data: {"id":"728c5695-1c40-4d02-8a60-d7ebd3cf7590","object":"chat.completion.chunk","created":1748586048,"model":"deepseek-chat","system_fingerprint":"fp_8802369eaa_prod0425fp8","choices":[{"index":0,"delta":{"content":""},"logprobs":null,"finish_reason":"stop"}],"usage":{"prompt_tokens":23,"completion_tokens":38,"total_tokens":61,"prompt_tokens_details":{"cached_tokens":0},"prompt_cache_hit_tokens":0,"prompt_cache_miss_tokens":23}}

data: [DONE]
```

å…¶ä¸­çš„å—ä¸»è¦æœ‰å‡ ç§ç±»å‹ï¼š

**ã€åˆå§‹å—ã€‘ï¼ˆè§’è‰²å£°æ˜ï¼‰ï¼š**

```json
{
  "id": "728c5695-1c40-4d02-8a60-d7ebd3cf7590",
  "object": "chat.completion.chunk",
  "created": 1748586048,
  "model": "deepseek-chat",
  "system_fingerprint": "fp_8802369eaa_prod0425fp8",
  "choices": [{
    "index": 0,
    "delta": {
      "role": "assistant",  // å£°æ˜AIè§’è‰²
      "content": ""         // åˆå§‹å†…å®¹ä¸ºç©º
    },
    "logprobs": null,
    "finish_reason": null   // ç”Ÿæˆæœªç»“æŸ
  }]
}
```

å»ºç«‹å¯¹è¯ä¸Šä¸‹æ–‡ï¼Œåƒæ˜¯ä¸€ä¸ª AI å‘å‡ºæ¶ˆæ¯ä¹‹å‰çš„å£°æ˜ï¼Œå£°æ˜æ¥ä¸‹æ¥å‘å‡ºæ¥çš„æ¶ˆæ¯æ˜¯ `assistant` çš„å›å¤ã€‚å…¶ä¸­çš„ `content` éƒ¨åˆ†ä¸ºç©ºï¼Œä»…ç”¨æ¥è®¾ç½®è§’è‰²ã€‚

**ã€å†…å®¹å¢é‡å—ã€‘ï¼ˆå¤šæ¬¡å‡ºç°ï¼‰**

```json
{
  "id": "728c5695-1c40-4d02-8a60-d7ebd3cf7590",
  ... // å…ƒæ•°æ®ç›¸åŒ
  "choices": [{
    "index": 0,
    "delta": {
      "content": "å½“ç„¶"  // å®é™…ç”Ÿæˆçš„å†…å®¹ç‰‡æ®µ
    },
    "logprobs": null,
    "finish_reason": null
  }]
}
```

è¿™éƒ¨åˆ†å°±æ˜¯ AI ç”Ÿæˆçš„å›å¤äº†ï¼Œåªä¸è¿‡æ¯æ¬¡ç”Ÿæˆçš„å†…å®¹éƒ½æ˜¯ä¸€ä¸ªåˆ†è¯ä¹‹åçš„ tokenã€‚æ¯ä¸ªå—ä¸­ä»…ä»…åŒ…å«æ–°å¢çš„å†…å®¹ï¼Œç”Ÿæˆçš„å›å¤å†…å®¹å°±æ”¾åœ¨ `content` ä¸­ã€‚ä¾‹å¦‚ï¼Œç¬¬ä¸€ä¸ªå¢é‡å—ä¸­ï¼Œ`content` çš„å†…å®¹æ˜¯ `å½“ç„¶`ï¼Œç¬¬äºŒä¸ªå¢é‡å—ä¸­ï¼Œ`content` çš„å†…å®¹æ˜¯ `å¯ä»¥`ï¼Œä¹‹åå†ä¸‹ä¸€ä¸ªå°±æ˜¯ `ï¼`ï¼Œä»¥æ­¤ç±»æ¨ã€‚

æœ‰çš„æ—¶å€™ä¹Ÿä¼šå‘é€ä¸€äº›ç©ºçš„ `content` å—ï¼Œæ¯”å¦‚è¯´ `content: ""`ï¼Œè¡¨ç¤ºå¿ƒè·³æˆ–å¤„ç†ä¸­ã€‚

**ã€ç»“æŸå—ã€‘ï¼ˆå…³é”®ä¿¡æ¯ï¼‰**

```json
{
  "id": "728c5695-1c40-4d02-8a60-d7ebd3cf7590",
  ... // å…ƒæ•°æ®ç›¸åŒ
  "choices": [{
    "index": 0,
    "delta": {
      "content": ""  // å†…å®¹ç»“æŸ
    },
    "logprobs": null,
    "finish_reason": "stop"  // åœæ­¢åŸå› 
  }],
  "usage": {  // å…³é”®ï¼Tokenä½¿ç”¨ç»Ÿè®¡
    "prompt_tokens": 23,         // é—®é¢˜æ¶ˆè€—Token
    "completion_tokens": 38,     // å›ç­”æ¶ˆè€—Token
    "total_tokens": 61,          // æ€»Token
    "prompt_tokens_details": {   // è¯¦ç»†ç»Ÿè®¡
      "cached_tokens": 0
    },
    "prompt_cache_hit_tokens": 0,
    "prompt_cache_miss_tokens": 23
  }
}
```

è¿™ä¸ªå—è·Ÿå‰é¢çš„å—ä¸­çš„æ¶ˆæ¯æœ‰å‡ ä¸ªä¸ä¸€æ ·ï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯ `finish_reason: "stop"`ï¼Œå‰é¢å…¶ä»–çš„ `finish_reason` éƒ½æ˜¯ `null`ï¼Œè¯´æ˜å‰é¢çš„éƒ½æ²¡æœ‰åœæ­¢ï¼Œä¸€ç›´åˆ°è¿™ä¸€æ¡æ¶ˆæ¯è¿™é‡Œï¼Œç”Ÿæˆæ‰åœæ­¢äº†ã€‚

ä»¥åŠè¿˜ä¼šåŒ…å«æœ¬æ¬¡å¯¹è¯çš„ä¸€äº›ä¿¡æ¯ï¼Œæ¯”å¦‚æœ¬æ¬¡ API è°ƒç”¨æ‰€æ¶ˆè€—çš„è¾“å…¥ `token`ã€è¾“å‡º `token`ï¼Œè¿˜æœ‰ä½¿ç”¨çš„æ€» `token`ï¼Œä»¥åŠç¼“å­˜æ˜¯å¦å‘½ä¸­ä¹‹ç±»çš„ä¿¡æ¯ã€‚

ç”Ÿæˆçš„æ–‡æœ¬ï¼Œå°±æ˜¯æ‰€æœ‰çš„å—ä¸­çš„ `choices.delta.content` æ‹¼æ¥åˆ°ä¸€èµ·ä¹‹åçš„ç»“æœã€‚

#### ä½¿ç”¨ SSE å¤„ç† Stream

```go
func TestStreamSSE(t *testing.T) {
	// io.ReadAll() ä¼šä¸€ç›´é˜»å¡ç›´åˆ°æµå®Œå…¨ç»“æŸï¼Œå¤±å»æµå¼å¤„ç†çš„ä¼˜åŠ¿ã€‚
	// æ¨èä½¿ç”¨ SSE è§£æå™¨è¿›è¡Œå¤„ç†
	url := "https://api.deepseek.com/chat/completions"
	method := "POST"

	// è¯»å– json æ–‡ä»¶å†…å®¹
	jsonBytes, err := os.ReadFile("request.json")
	if err != nil {
		panic(err)
	}

	payload := strings.NewReader(string(jsonBytes))

	client := &http.Client{}
	req, err := http.NewRequest(method, url, payload)

	if err != nil {
		fmt.Println(err)
		return
	}
	req.Header.Add("Content-Type", "application/json")
	req.Header.Add("Accept", "application/json")
	req.Header.Add("Authorization", "Bearer sk-ef1919aca52c421a9b6d1e60756e8acd")

	res, err := client.Do(req)
	if err != nil {
		fmt.Println(err)
		return
	}
	defer res.Body.Close()

	scanner := bufio.NewScanner(res.Body)
	scanner.Split(func(data []byte, atEOF bool) (advance int, token []byte, err error) {
		// è‡ªå®šä¹‰ SSE åˆ†å‰²é€»è¾‘
		if i := bytes.Index(data, []byte("\n\n")); i >= 0 {
			return i + 2, data[:i], nil
		}
		return 0, nil, nil
	})

	for scanner.Scan() {
		event := scanner.Text()
		if strings.HasPrefix(event, "data: ") {
			jsonData := event[6:] // å»æ‰ "data: " å‰ç¼€

			// å¤„ç†ç»“æŸæ ‡è®°
			if jsonData == "[DONE]" {
				break
			}

			// è§£æ JSON
			var resp struct {
				Choices []struct {
					Delta struct {
						Content string `json:"content"`
					}
				}
				Usage *struct {
					PromptTokens     int `json:"prompt_tokens"`
					CompletionTokens int `json:"completion_tokens"`
					TotalTokens      int `json:"total_tokens"`
				}
			}
			json.Unmarshal([]byte(jsonData), &resp)

			// å¤„ç†å†…å®¹
			if len(resp.Choices) > 0 {
				fmt.Print(resp.Choices[0].Delta.Content)
			}

			// å¤„ç†ç”¨é‡ç»Ÿè®¡
			if resp.Usage != nil {
				fmt.Printf("\nUsage: %+v\n", resp.Usage)
			}
		}
	}

}

```

è¿è¡Œä¹‹åä¼š**é™†é™†ç»­ç»­**è¾“å‡ºï¼š

```go
è‹¹æœæ˜¯ä¸€ç§è¥å…»ä¸°å¯Œçš„æ°´æœï¼Œå…·æœ‰ä»¥ä¸‹ä¸»è¦å¥åº·ä»·å€¼ï¼š

// ...

è‹¹æœçš„"æ¯å¤©ä¸€è‹¹æœï¼ŒåŒ»ç”Ÿè¿œç¦»æˆ‘"è™½å¤¸å¼ ï¼Œä½†å…¶å‡è¡¡è¥å…»ç¡®ä¸ºå¥åº·é¥®é£Ÿçš„è‰¯å¥½é€‰æ‹©ã€‚
Usage: &{PromptTokens:22 CompletionTokens:294 TotalTokens:316}
```

å…¶ä¸­ï¼Œ`SSE(Server-Sent Events)` å¤„ç†æµå¼çš„è¯·æ±‚ç›¸æ¯” `ReadAll()` æœ‰ä»¥ä¸‹å‡ ä¸ªä¼˜åŠ¿ï¼š

- å†…å­˜å ç”¨æ¯”è¾ƒå°ã€‚`ReadAll()` æ˜¯å°†æ‰€æœ‰çš„è¿”å›ä½“å†…å®¹éƒ½æ”¾åˆ°ä¸€èµ·ï¼Œç„¶åä¸€å—è¿”å›ç»™ç”¨æˆ·ã€‚è¿™æ ·å°±ä¼šå¯¼è‡´ï¼Œå¦‚æœè¿”å›çš„å†…å®¹æ¯”è¾ƒå¤šï¼Œä¼šä¸€ä¸‹å æ»¡å†…å­˜ã€‚ä½†æ˜¯å¦‚æœä½¿ç”¨ SSEï¼Œæ¥æ”¶åˆ°ä¸€å°å—å†…å®¹ä¹‹åå°±ä¼šç«‹é©¬å°†è¿™ä¸€å°å—å†…å®¹å€’å‡ºæ¥ï¼Œç„¶åå†å»æ¥å—æ–°çš„å†…å®¹ã€‚è¿™æ ·éœ€è¦æ”¾åœ¨å†…å­˜ä¸­çš„æ•°æ®å°±ä¸ä¼šç‰¹åˆ«å¤§ã€‚
- å¯ä»¥è®©ç”¨æˆ·çœ‹åˆ°å³æ—¶å“åº”çš„æ•ˆæœã€‚`ReadAll()` æ˜¯å°†æ‰€æœ‰æ•°æ®éƒ½æ”¾åˆ°ä¸€èµ·ï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½æ¥æ”¶å®Œæ¯•ä¹‹åï¼Œæ‰ä¼šä¸€æ¬¡å…¨éƒ¨è¾“å‡ºã€‚ä½†æ˜¯æµå¼è¾“å‡ºå°±å¯ä»¥å®ç°ï¼šè¿”å›å¤šå°‘å†…å®¹ï¼Œè¾“å‡ºå¤šå°‘å†…å®¹ã€‚è¿™æ ·ä»è§†è§‰æ•ˆæœä¸Šå°±å®ç°äº†å®æ—¶æ€§ã€‚
- å¯ä»¥åœ¨ä¸­é—´éšæ—¶åœæ­¢ç»§ç»­æ¥å—ã€‚æ¯”å¦‚è¯´æˆ‘çš„ä¸€ä¸ªä¸šåŠ¡éœ€æ±‚å°±æ˜¯ï¼Œåœ¨ä¸­é—´æ¥æ”¶åˆ°æŸä¸€ä¸ªæ¶ˆæ¯ï¼ˆæ¯”å¦‚å…¶ä¸­åŒ…å« `End` çš„æ¶ˆæ¯ï¼‰ä¹‹åï¼Œåé¢æ‰€æœ‰çš„æ•°æ®å°±éƒ½ä¸è¦äº†ï¼Œåœæ­¢æ•°æ®çš„æ¥æ”¶ã€‚`SSE` å¯ä»¥å®ç°è¿™ä¸ªéœ€æ±‚ã€‚

#### ~~`stream_options`~~

è¿™ä¸ªé€‰é¡¹åªæœ‰ `stream` è®¾ç½®ä¸º `true` çš„æ—¶å€™æ‰å¯ä»¥ä½¿ç”¨ã€‚æˆ‘ä»¬å°±ç”¨ `ReadAll()` æ–¹æ³•æ¥çœ‹åŒºåˆ«ã€‚

å¦‚æœåªæ˜¯è®¾ç½®äº† `stream`ï¼Œä½†æ˜¯æ²¡æœ‰è®¾ç½®é¢å¤–çš„ `stream_options`ï¼Œæœ€åçš„è¾“å‡ºï¼š

```go
data: {"id":"cc216c42-98fa-4f26-ade8-aa11feed1e11","object":"chat.completion.chunk","created":1748589142,"model":"deepseek-chat","system_fingerprint":"fp_8802369eaa_prod0425fp8","choices":[{"index":0,"delta":{"content":"ï¼‰ã€‚"},"logprobs":null,"finish_reason":null}]}

data: {"id":"cc216c42-98fa-4f26-ade8-aa11feed1e11","object":"chat.completion.chunk","created":1748589142,"model":"deepseek-chat","system_fingerprint":"fp_8802369eaa_prod0425fp8","choices":[{"index":0,"delta":{"content":""},"logprobs":null,"finish_reason":"stop"}],"usage":{"prompt_tokens":22,"completion_tokens":230,"total_tokens":252,"prompt_tokens_details":{"cached_tokens":0},"prompt_cache_hit_tokens":0,"prompt_cache_miss_tokens":22}}

data: [DONE]
```

å¦‚æœè®¾ç½®ï¼š

```json
    "stream": true,
    "stream_options": {
        "include_usage": true
    },
```

é‚£ä¹ˆè°ƒç”¨ API å°±ä¼šè¾“å‡ºï¼š

```go
ata: {"id":"4c9d1c89-5521-4c41-88aa-4fad4cd85bf1","object":"chat.completion.chunk","created":1748589225,"model":"deepseek-chat","system_fingerprint":"fp_8802369eaa_prod0425fp8","choices":[{"index":0,"delta":{"content":"ã€‚"},"logprobs":null,"finish_reason":null}],"usage":null}

data: {"id":"4c9d1c89-5521-4c41-88aa-4fad4cd85bf1","object":"chat.completion.chunk","created":1748589225,"model":"deepseek-chat","system_fingerprint":"fp_8802369eaa_prod0425fp8","choices":[{"index":0,"delta":{"content":""},"logprobs":null,"finish_reason":"stop"}],"usage":{"prompt_tokens":22,"completion_tokens":267,"total_tokens":289,"prompt_tokens_details":{"cached_tokens":0},"prompt_cache_hit_tokens":0,"prompt_cache_miss_tokens":22}}

data: [DONE]
```

å¯ä»¥çœ‹åˆ°è¾“å‡ºçš„å†…å®¹å®Œå…¨ä¸€æ ·ï¼

æƒ…å†µæ˜¯å°±ç®—æ²¡æœ‰åœ¨ `stream_options` ä¸­æ˜ç¡®å£°æ˜ `include_usage`ï¼Œä¹Ÿä¼šè¾“å‡ºå®é™…ä½¿ç”¨çš„ `Usage`ã€‚

æ¨æµ‹æ˜¯è¿™ä¸ªé€‰é¡¹å·²ç»è¢«ç§»é™¤äº†ã€‚

#### `temperature` å’Œ `top_p`

ä½œç”¨å·®ä¸å¤šï¼Œéƒ½æ˜¯ç”¨æ¥è°ƒæ•´æ¨¡å‹çš„æ´»è·ƒåº¦çš„ã€‚

å¦‚æœ `temprature` è®¾ç½®çš„æ¯”è¾ƒé«˜ï¼Œé‚£ä¹ˆè¾“å‡ºçš„æ–‡æœ¬ä¸­ä¼šæœ‰æ›´å¤šä¸ç¡®å®šçš„è¯ï¼Œæ¯”è¾ƒé€‚åˆç”¨äºåˆ›ä½œä¸€äº›è¯—è¯ä¹‹ç±»çš„ä¸œè¥¿ã€‚å¦‚æœ `temprature` è®¾ç½®çš„æ¯”è¾ƒä½ï¼Œé‚£ä¹ˆè¾“å‡ºçš„æ–‡æœ¬å°±ä¼šæ›´åŠ ä¿å®ˆï¼Œè¿™æ—¶å€™å°±æ¯”è¾ƒé€‚åˆå»å†™ä¸€äº›ç»¼è¿°ä¹‹ç±»çš„æ–‡æ¡£ï¼Œè¿™æ ·ä¿¡æ¯ä¼šæ›´åŠ å‡†ç¡®ã€‚

`top_p` ä¹Ÿæ˜¯å·®ä¸å¤šçš„æ•ˆæœï¼Œå€¼è®¾ç½®çš„æ¯”è¾ƒé«˜ï¼Œç”Ÿæˆå†…å®¹è‡ªç”±åº¦å°±æ›´é«˜ï¼Œæ¯”è¾ƒä½çš„è¯ï¼Œç”Ÿæˆå†…å®¹å°±æ¯”è¾ƒä¿å®ˆã€‚

ä½†æ˜¯å®ç°åŸç†æ˜¯ä¸ä¸€æ ·çš„ã€‚

æ¯”å¦‚è¯´æ¨¡å‹å¯¹ä¸‹ä¸€ä¸ªå‡ºç°çš„è¯çš„æ¦‚ç‡æ˜¯ï¼š

| Aï¼š0.4 | Bï¼š0.3 | Cï¼š0.2 | Dï¼š0.1 |
| ------ | ------ | ------ | ------ |

é‚£ä¹ˆå¦‚æœæˆ‘ä»¬è®¾ç½®äº†ä½ `temprature`ï¼Œé‚£ä¹ˆä¹‹åå¯èƒ½ä¼šå˜æˆï¼š

| Aï¼š0.6 | Bï¼š0.2 | Cï¼š0.15 | Dï¼š0.05 |
| ------ | ------ | ------- | ------- |

æ„æ€å°±æ˜¯åŸæœ¬å‡ºç°é¢‘ç‡å°±æ¯”è¾ƒé«˜çš„è¯ï¼Œä¹‹åå‡ºç°é¢‘ç‡ä¼šæ›´é«˜ï¼›åŸæœ¬å°±æ¯”è¾ƒä½çš„è¯ï¼Œä¹‹åå‡ºç°çš„é¢‘ç‡ä¹Ÿä¼šæ›´ä½ã€‚

å¦‚æœæˆ‘ä»¬æ˜¯è®¾ç½®äº†ä½çš„ `top_p`ï¼Œé‚£ä¹ˆåŸæœ¬å‡ºç°é¢‘ç‡æ¯”è¾ƒä½çš„é€‰é¡¹ C å’Œ D å°±ä¼šç›´æ¥è¢«åˆ å»ï¼Œå‡ºç°æ¦‚ç‡å˜æˆä¸‹é¢è¿™æ ·ï¼š

| Aï¼š0.57 | Bï¼š0.43 |
| ------- | ------- |

ä½†æ˜¯è¦æ³¨æ„ï¼Œ`temperature` å’Œ `top_p` ä¸å¯ä»¥åŒæ—¶ä¿®æ”¹ï¼Œä¼šå¯¼è‡´ä¸å¯é¢„æµ‹çš„åæœï¼









